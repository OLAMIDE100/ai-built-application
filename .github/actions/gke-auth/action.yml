

name: Google-cloud and GKE authentication
runs:
  using: "composite"
  steps:
    - name: Authenticate to Google Cloud
      uses: 'google-github-actions/auth@v3'
      with:
        service_account: 'terraform-test-deployment@nabuminds-test.iam.gserviceaccount.com'
        workload_identity_provider: 'projects/563370139005/locations/global/workloadIdentityPools/bitbucket/providers/repository'

    - name: Set up Cloud SDK
      uses: google-github-actions/setup-gcloud@v2

    - name: Configure kubectl
      shell: bash
      run: |
        gcloud components install gke-gcloud-auth-plugin
        gcloud container clusters get-credentials general-cluster --region europe-west3 --project nabuminds-test
        kubectl create namespace snake-game --dry-run=client -o yaml | kubectl apply -f -